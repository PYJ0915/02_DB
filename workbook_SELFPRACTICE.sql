
-- 1. 새로운 학과를 추가하시오.

/* 학과번호: '064', 학과명: '데이터사이언스학과',
   계열: '공학', 개설여부: 'Y', 정원: 30*/

SELECT * FROM TB_DEPARTMENT2;

INSERT INTO TB_DEPARTMENT2 VALUES('064', '데이터사이언스학과', '공학', 'Y', 30);

-- 2. '데이터사이언스학과'의 정원을 40으로 수정하시오.
UPDATE TB_DEPARTMENT2 SET CAPACITY = 40
WHERE DEPARTMENT_NAME = '데이터사이언스학과';

-- 3. '데이터사이언스학과'를 삭제하시오.
DELETE FROM TB_DEPARTMENT2
WHERE DEPARTMENT_NAME = '데이터사이언스학과';

SELECT * FROM TB_CLASS2;

-- 4. '국어국문학과'에 두 개의 새로운 과목을 추가하고, ROLLBACK으로 복원하시오.
INSERT INTO TB_CLASS2 VALUES('C9999999', '001', NULL, '한글정보처리', '전공선택');
INSERT INTO TB_CLASS2 VALUES('C9999998', '001', NULL, '고전시가', '전공선택');

ROLLBACK;

-- 5. 다시 '한글정보처리' 과목을 추가하고, COMMIT을 수행하시오.
INSERT INTO TB_CLASS2 VALUES('C9999999', '001', NULL, '한글정보처리', '전공선택');

COMMIT;

-- 6. 각 과목의 이름과 해당 학과명을 조회하시오. (학과가 없는 과목도 모두 표시)
SELECT * FROM TB_DEPARTMENT2;
SELECT * FROM TB_CLASS2;
SELECT * FROM TB_PROFESSOR2;
SELECT * FROM TB_STUDENT2;

SELECT CLASS_NAME, DEPARTMENT_NAME 
FROM TB_CLASS2  
LEFT JOIN TB_DEPARTMENT2 USING(DEPARTMENT_NO);

-- 7. 각 교수의 이름과 소속 학과명을 조회하시오.
SELECT PROFESSOR_NAME, DEPARTMENT_NAME
FROM TB_PROFESSOR2 
JOIN TB_DEPARTMENT2 USING(DEPARTMENT_NO);

-- 8. 각 학생의 이름, 소속 학과명, 지도 교수 이름을 조회하시오. (지도 교수가 없는 학생도 포함)
SELECT STUDENT_NAME, DEPARTMENT_NAME, PROFESSOR_NAME
FROM TB_STUDENT2 
JOIN TB_DEPARTMENT2 USING(DEPARTMENT_NO)
LEFT JOIN TB_PROFESSOR2 ON (COACH_PROFESSOR_NO = PROFESSOR_NO);

 -- 9. 문제 1. 조인 구조 심화 — 지도교수가 소속 학과와 다른 학과 학생 찾기

/*	
  - 조건
    TB_STUDENT와 TB_PROFESSOR를 조인하여 학생의 학과(DEPARTMENT_NO)와 지도교수의 학과(DEPARTMENT_NO)가 다른 경우만 조회하시오.
    
  - 출력 컬럼: 학생이름(STUDENT_NAME), 학생학과명(DEPARTMENT_NAME), 지도교수명(PROFESSOR_NAME), 지도교수학과명(PROFESSOR_DEPT_NAME)
	결과는 학생이름 오름차순 정렬 
*/

SELECT * FROM TB_CLASS_PROFESSOR;
SELECT * FROM TB_PROFESSOR;
SELECT * FROM TB_DEPARTMENT;
SELECT * FROM TB_STUDENT;
SELECT * FROM TB_GRADE;
SELECT * FROM TB_CLASS;

SELECT STUDENT_NAME "학생이름", TD.DEPARTMENT_NAME "학생의 학과", PROFESSOR_NAME "지도교수명", TD2.DEPARTMENT_NAME "교수 학과명"
FROM TB_STUDENT TS JOIN TB_DEPARTMENT TD ON(TS.DEPARTMENT_NO = TD.DEPARTMENT_NO)
JOIN TB_PROFESSOR TP ON (COACH_PROFESSOR_NO = TP.PROFESSOR_NO)
JOIN TB_DEPARTMENT TD2 ON (TP.DEPARTMENT_NO = TD2.DEPARTMENT_NO)
WHERE TS.DEPARTMENT_NO != TP.DEPARTMENT_NO
ORDER BY 1;

-- 10. 환경조경학과와 같은 CATEGORY(계열)에 속한 학과들의 과목 중에서 가장 평균 평점이 높은 과목명과 해당 학과명을 조회하시오
SELECT 학과명, 과목명, 평균평점 
FROM(SELECT RANK() OVER(ORDER BY AVG(POINT) DESC) 순위, DEPARTMENT_NAME 학과명, CLASS_NAME 과목명, AVG(POINT) 평균평점
FROM TB_DEPARTMENT 
JOIN TB_CLASS USING(DEPARTMENT_NO)
JOIN TB_GRADE USING(CLASS_NO)
WHERE CATEGORY = (SELECT CATEGORY FROM TB_DEPARTMENT WHERE DEPARTMENT_NAME = '환경조경학과')
GROUP BY DEPARTMENT_NAME, CLASS_NAME)
WHERE 순위 IN(1);

-- 11. 학교 성적 관리 시스템 구축 (DDL + DML + JOIN + SUBQUERY)
-- 학교 데이터베이스를 설계하고, 학생·과목·성적 정보를 관리하는 SQL문을 작성하시오.

-- 1) 테이블 생성 (DDL)
/*
	STUDENT : 학번, 이름, 학과명, 입학일
	SUBJECT : 과목번호, 과목명, 구분(전공/교양 등)
	GRADE : 학번, 과목번호, 점수

	요구사항
	각 테이블의 기본키와 외래키를 올바르게 설정할 것
	성적(POINT)은 0.0 ~ 4.5 사이의 값만 허용되도록 제약조건 추가
*/


CREATE TABLE STUDENT(
	STUDENT_NO NUMBER PRIMARY KEY,
	STUDENT_NAME VARCHAR2(30),
	DEPT_NAME VARCHAR2(50),
	ENTRANCE_DATE DATE DEFAULT SYSDATE
);

CREATE TABLE SUBJECT (
	SUBJECT_NO VARCHAR2(20) PRIMARY KEY,
	SUBJECT_NAME VARCHAR2(50),
	CATEGORY VARCHAR2(50)
);

CREATE TABLE GRADE(
	STUDENT_NO NUMBER REFERENCES STUDENT,
	SUBJECT_NO VARCHAR2(20) REFERENCES SUBJECT,
	POINT NUMBER CHECK(POINT BETWEEN 0.0 AND 4.5),
	CONSTRAINT PKEY_GRADE PRIMARY KEY (STUDENT_NO, SUBJECT_NO)
); 

-- 외래키이면서 그 테이블의 기본키일 수 있다!!

-- 2.데이터 삽입 (DML)
INSERT INTO STUDENT VALUES(2023001, '김민준', '컴퓨터공학과', '2023-03-02');
INSERT INTO STUDENT VALUES(2023002, '이서연', '경영학과', '2023-03-02');
INSERT INTO STUDENT VALUES(2023003, '박지후', '전자공학과', '2023-03-02');
INSERT INTO STUDENT VALUES(2023004, '정하은', '디자인학과', '2023-03-02');
INSERT INTO STUDENT VALUES(2023005, '한도윤', '수학과', '2023-03-02');

INSERT INTO SUBJECT VALUES('C101', '데이터베이스', '전공');
INSERT INTO SUBJECT VALUES('C102', '운영체제', '전공');
INSERT INTO SUBJECT VALUES('C103', '통계학', '교양');
INSERT INTO SUBJECT VALUES('C104', '회계원리', '교양');

INSERT INTO GRADE VALUES(2023001, 'C101', 4.2);
INSERT INTO GRADE VALUES(2023001, 'C102', 3.8);
INSERT INTO GRADE VALUES(2023002, 'C103', 3.5);
INSERT INTO GRADE VALUES(2023002, 'C104', 3.2);
INSERT INTO GRADE VALUES(2023003, 'C101', 4.1);
INSERT INTO GRADE VALUES(2023003, 'C102', 3.9);
INSERT INTO GRADE VALUES(2023004, 'C104', 3.6);
INSERT INTO GRADE VALUES(2023005, 'C103', 4.4);

-- 3) 조회 및 분석 문제

/*
	1. 모든 학생의 이름, 학과명, 입학일을 조회하시오.
	2️. 각 학생의 평균 평점을 구하시오.
	3️. 평균 평점이 3.5 이상인 학생만 조회하시오.
	4️. 과목별 최고 점수를 받은 학생 이름과 점수를 조회하시오.
	5️. 학과별로 평균 점수가 가장 높은 학생을 조회하시오.
	6️. “컴퓨터공학과” 학생들의 평균보다 높은 점수를 받은 학생을 조회하시오.
	7.️ 학생 이름에 ‘하’가 포함된 학생을 조회하시오.*/

-- 1
SELECT STUDENT_NAME, DEPT_NAME, ENTRANCE_DATE
FROM STUDENT;

-- 2
SELECT STUDENT_NAME, AVG(POINT) FROM GRADE
JOIN STUDENT USING (STUDENT_NO)
GROUP BY STUDENT_NAME;

-- 3















